<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Build a Simple Compiler Ep0</title><link rel=alternate type=application/rss+xml title=RSS href=https://aben20807.github.io/index.xml><link rel=canonical href=https://aben20807.github.io/posts/20210722-build-a-simple-compiler-ep0/><link rel="shortcut icon" type=image/png href=https://aben20807.github.io/apple-touch-icon-precomposed.png><meta name=generator content="Hugo 0.80.0"><meta name=og:title content="Build a Simple Compiler Ep0"><meta name=og:type content="article"><meta name=og:image content="https://images.unsplash.com/photo-1466692476868-aef1dfb1e735?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&ixlib=rb-1.2.1&auto=format&fit=crop&w=1650&q=80"><meta name=og:description content><meta name=og:url content="https://aben20807.github.io/posts/20210722-build-a-simple-compiler-ep0/"><meta name=og:site_name content="Build a Simple Compiler Ep0"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@"><script src=https://cdn.jsdelivr.net/npm/fetch-inject@2.0.4/dist/fetch-inject.umd.min.js integrity="sha256-paKBtnIrL5ClLfBOtgxh1UqYCjL9790IRvDOnBh2LyI=" crossorigin=anonymous></script><link rel=stylesheet href=https://aben20807.github.io/css/tachyons.min.css async><link rel=stylesheet href=https://aben20807.github.io/css/story.css async><link rel=stylesheet href=https://aben20807.github.io/css/hugouo.css async><link rel=stylesheet href=https://aben20807.github.io/css/allinone.css async><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.5.0/css/all.css integrity=sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU crossorigin=anonymous async><link href="https://fonts.googleapis.com/css?family=Quattrocento+Sans:400,400i|Lora:400|Noto+Sans+TC:400,400i|Milonga:400|Roboto+Mono:500&subset=latin-ext" rel=stylesheet async><script src=https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.1/lazysizes.min.js></script><noscript><style type=text/css>.lazyload{display:none}</style></noscript><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-123296010-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class="ma0 bg-white section-posts page-kind-page is-page-true"><header class="cover bg-top" style="background-image:url(https://images.unsplash.com/photo-1466692476868-aef1dfb1e735?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&ixlib=rb-1.2.1&auto=format&fit=crop&w=1650&q=80);background-position:50%"><div class="bg-black-60 bb bt"><nav class="hide-print sans-serif border-box pa3 ph5-l"><a href=https://aben20807.github.io/ title=Home><img src=https://aben20807.github.io/img/logo.jpg class="w2 h2 br-100" alt=記錄用></a><div class="fr h2 pv2 tr"><a class="link f5 ml2 dim near-white no-underline-on-hover" href=/categories/>分類</a>
<a class="link f5 ml2 dim near-white no-underline-on-hover" href=/tags/>標籤</a>
<a class="link f5 ml2 dim near-white no-underline-on-hover" href=/about>關於</a>
<a class="link f5 ml2 dim near-white no-underline-on-hover" href=https://github.com/aben20807/blog-post target=_blank rel="noreferrer noopener"><i class="fab fa-github-square"></i></a><a class="link f5 ml2 dim near-white no-underline-on-hover" href=https://www.linkedin.com/in/po-hsuan-huang-6587b6117/ target=_blank rel="noreferrer noopener"><i class="fab fa-linkedin"></i></a><a class="link f5 ml2 dim near-white no-underline-on-hover" href=https://www.youtube.com/channel/UCEiQdnpoVJcaca7jWlPjEdw target=_blank rel="noreferrer noopener"><i class="fab fa-youtube-square"></i></a><a class="link f5 ml2 dim near-white fas fa-rss-square no-underline-on-hover" href=https://aben20807.github.io/index.xml title="RSS Feed"></a><a class="link f5 ml2 dim near-white fas fa-envelope no-underline-on-hover" href=https://aben20807.github.io/subscription/ role=subscription title=Subscription></a><a class="link f5 ml2 dim near-white fas fa-search no-underline-on-hover" href=https://aben20807.github.io/search/ role=search title=Search></a></div></nav><div id=hdr class="tc-l pv4-ns pv5-l pv2 ph3 ph4-ns"><h1 class="near-white mt1-ns f2 fw3 mb0 mt0 lh-title">Build a Simple Compiler Ep0</h1><h2 class="near-white mt3-l mb4-l fw1 f6 f3-l measure-wide-l center lh-copy mt2 mb3">Published
<time datetime=2021-07-22T17:17:52+08:00>Jul 22, 2021</time>
<span class=display-print>by Huang Po-Hsuan</span>
in <a href=https://aben20807.github.io/categories/%E7%B7%A8%E8%AD%AF%E5%99%A8 class="no-underline category title-link near-white dim">編譯器</a>
<span class=display-print>at https://aben20807.github.io/posts/20210722-build-a-simple-compiler-ep0/</span></h2></div><div class="w-100 cf hide-print"><a class="fr f6 ma0 pa2 link white-50 dim fas fa-camera" href=https://unsplash.com/photos/vrbZVyX2k4I title="Photo Credit"></a></div></div></header><main role=main><div class="row bg-white"><div class="column col-1 printable"><article class="center bg-white br-3 pv1 ph4 lh-copy f5 nested-links" style=max-width:720px><div class=row><div class=col-md-8><div class=mb-5><div class="li-x div-x post-meta"><li class=pr-0><a href=https://aben20807.github.io/tags/><i class="fas fa-tags"></i></a></li><div class=tags-sm><li><a href=https://aben20807.github.io/tags/flex role=button class="no-underline no-underline-on-hover">flex</a></li><li><a href=https://aben20807.github.io/tags/bison role=button class="no-underline no-underline-on-hover">bison</a></li><li><a href=https://aben20807.github.io/tags/compiler role=button class="no-underline no-underline-on-hover">compiler</a></li><li><a href=https://aben20807.github.io/tags/lex role=button class="no-underline no-underline-on-hover">lex</a></li><li><a href=https://aben20807.github.io/tags/yacc role=button class="no-underline no-underline-on-hover">yacc</a></li></div></div></div></div></div><script src=https://code.iconify.design/1/1.0.0-rc6/iconify.min.js></script><p>說明及事前準備</p><ul><li>Series: <a href=https://aben20807.github.io/posts/20210722-build-a-simple-compiler-ep0/ class=self-link>[ep0]</a>, <a href=https://aben20807.github.io/posts/20210722-build-a-simple-compiler-ep1/ class=self-link>[ep1]</a>, <a href=https://aben20807.github.io/posts/20210722-build-a-simple-compiler-ep2/ class=self-link>[ep2]</a>, <a href=https://aben20807.github.io/posts/20210722-build-a-simple-compiler-ep3/ class=self-link>[ep3]</a></li><li>Source code: <a href=https://github.com/aben20807/learn_compiler target=_blank rel="noreferrer noopener">aben20807/learn_compiler</a></li></ul><h1 id=前言 class=article-heading>前言<a class="headline-hash smoothScroll hover-show scrollspy" style=font-size:.75em;color:#000;padding-left:.25em href=#前言><span class=iconify data-icon=octicon-link data-inline=false></span></a></h1><p>雖然好像很多相關資料了，但我覺得還是欠缺完整性，所以就寫了這個系列來補全。儘管還是有少數人無論如何都選擇直接抄襲同學這條路，但還是希望透過本系列能夠清楚完整的帶領完全沒概念的人走一遍，藉此降低這些行為。</p><p>雖然我算是蠻常使用本系列所介紹的這套工具了，不過可能還是會有錯誤的地方，還請各位不吝指教。</p><h1 id=本篇所建構的編譯器 class=article-heading>本篇所建構的編譯器<a class="headline-hash smoothScroll hover-show scrollspy" style=font-size:.75em;color:#000;padding-left:.25em href=#本篇所建構的編譯器><span class=iconify data-icon=octicon-link data-inline=false></span></a></h1><p>本系列內容為使用 flex/bison (lex/yacc) 建構一個簡易的編譯器，並使其產生的 jasmin 指令可在 JVM 執行。完整執行流程如下。我們會利用 flex 產生 scanner，利用 bison 產生 parser。</p><p><figure class="gphoto-media center"><div class="img-container center" style=width:73%><noscript><img src="https://lh3.googleusercontent.com/pw/AM-JKLVfavnVca_5BLSfCjR9c4-qX2B3aClIeT0xi-dKP7OA3I6YQ6wpE7Xpesp1-TiV7scUERknJm54uRRowNcFRd1vm7irZP_97aKpwDJMTSH8d5B0bcyF6whs077_llSwlHZyCey4jSwH4XqjpQ8O2vJ5pQ=w551-h281-no" class="center img-zoomable" alt=流程，橘色區塊為本系列需要寫程式的部分 data-action=zoom></noscript><img data-src="https://lh3.googleusercontent.com/pw/AM-JKLVfavnVca_5BLSfCjR9c4-qX2B3aClIeT0xi-dKP7OA3I6YQ6wpE7Xpesp1-TiV7scUERknJm54uRRowNcFRd1vm7irZP_97aKpwDJMTSH8d5B0bcyF6whs077_llSwlHZyCey4jSwH4XqjpQ8O2vJ5pQ=w551-h281-no" class="center img-zoomable lazyload" alt=流程，橘色區塊為本系列需要寫程式的部分 data-action=zoom></div><figcaption><center class=caption-text><p style="margin:.7rem 0 0">流程，橘色區塊為本系列需要寫程式的部分</p><font class="douyin hover-show"><a href="https://lh3.googleusercontent.com/pw/AM-JKLVfavnVca_5BLSfCjR9c4-qX2B3aClIeT0xi-dKP7OA3I6YQ6wpE7Xpesp1-TiV7scUERknJm54uRRowNcFRd1vm7irZP_97aKpwDJMTSH8d5B0bcyF6whs077_llSwlHZyCey4jSwH4XqjpQ8O2vJ5pQ=w551-h281-no" target=_blank rel="noreferrer noopener" style=opacity:1;text-decoration:none>OuO</a></font></center></figcaption></figure></p><h1 id=環境設定 class=article-heading>環境設定<a class="headline-hash smoothScroll hover-show scrollspy" style=font-size:.75em;color:#000;padding-left:.25em href=#環境設定><span class=iconify data-icon=octicon-link data-inline=false></span></a></h1><h2 id=作業系統 class=article-heading>作業系統<a class="headline-hash smoothScroll hover-show scrollspy" style=font-size:.75em;color:#000;padding-left:.25em href=#作業系統><span class=iconify data-icon=octicon-link data-inline=false></span></a></h2><ul><li>OS: Ubuntu 18.04 (我使用 WSL2)</li></ul><h2 id=軟體安裝 class=article-heading>軟體安裝<a class="headline-hash smoothScroll hover-show scrollspy" style=font-size:.75em;color:#000;padding-left:.25em href=#軟體安裝><span class=iconify data-icon=octicon-link data-inline=false></span></a></h2><ul><li>gcc: 7.5.0 (<code>gcc -v</code>)</li><li>gnu make: 4.1 (<code>make -v</code>)</li><li>flex: 2.6.4 (<code>flex --version</code>)</li><li>bison: 3.0.4 (<code>bison --version</code>)</li><li>java: openjdk 11.0.10 (<code>java --version</code>)</li><li>安裝指令: <code>$ sudo apt install gcc make flex bison default-jre</code></li></ul><h1 id=定義本次教學的語言 class=article-heading>定義本次教學的語言<a class="headline-hash smoothScroll hover-show scrollspy" style=font-size:.75em;color:#000;padding-left:.25em href=#定義本次教學的語言><span class=iconify data-icon=octicon-link data-inline=false></span></a></h1><p>主要特性: 包含賦值、基本四則運算、輸出。</p><h2 id=型別-type class=article-heading>型別 type<a class="headline-hash smoothScroll hover-show scrollspy" style=font-size:.75em;color:#000;padding-left:.25em href=#型別-type><span class=iconify data-icon=octicon-link data-inline=false></span></a></h2><ul><li>整數 (num_lit), e.g., <code>1</code>, <code>2</code></li><li>變數 (ident), e.g., <code>x</code>, <code>y</code>, <code>num</code></li></ul><h2 id=運算子-operator class=article-heading>運算子 operator<a class="headline-hash smoothScroll hover-show scrollspy" style=font-size:.75em;color:#000;padding-left:.25em href=#運算子-operator><span class=iconify data-icon=octicon-link data-inline=false></span></a></h2><ul><li><code>+</code>: 加</li><li><code>-</code>: 減</li><li><code>*</code>: 乘</li><li><code>/</code>: 除</li><li><code>=</code>: 宣告時賦值</li></ul><h2 id=其他符號 class=article-heading>其他符號<a class="headline-hash smoothScroll hover-show scrollspy" style=font-size:.75em;color:#000;padding-left:.25em href=#其他符號><span class=iconify data-icon=octicon-link data-inline=false></span></a></h2><ul><li><code>(</code> <code>)</code>: 運算有最高優先度</li><li><code>\n</code> (newline): 換行作為結尾</li></ul><h2 id=關鍵字-keyword class=article-heading>關鍵字 keyword<a class="headline-hash smoothScroll hover-show scrollspy" style=font-size:.75em;color:#000;padding-left:.25em href=#關鍵字-keyword><span class=iconify data-icon=octicon-link data-inline=false></span></a></h2><ul><li><code>decl</code></li><li><code>print</code></li></ul><h2 id=簡化的文法-grammar class=article-heading>簡化的文法 grammar<a class="headline-hash smoothScroll hover-show scrollspy" style=font-size:.75em;color:#000;padding-left:.25em href=#簡化的文法-grammar><span class=iconify data-icon=octicon-link data-inline=false></span></a></h2><ul><li>未標示運算子優先順序，但是符合先乘除後加減，括號優先度最高。</li></ul><pre><code>Statement -&gt; DeclStmt
          | PrintStmt

DeclStmt -&gt; &quot;decl&quot; ident &quot;=&quot; Expression newline

PrintStmt -&gt; &quot;print&quot; Expression newline

Expression -&gt; Expression BinaryOp Expression
           | Operand
           
Operand -&gt; num_lit
        | ident
        | &quot;(&quot; Expression &quot;)&quot;

BinaryOp -&gt; &quot;+&quot; | &quot;-&quot; | &quot;*&quot; | &quot;/&quot;
</code></pre><h2 id=範例輸入 class=article-heading>範例輸入<a class="headline-hash smoothScroll hover-show scrollspy" style=font-size:.75em;color:#000;padding-left:.25em href=#範例輸入><span class=iconify data-icon=octicon-link data-inline=false></span></a></h2><pre><code>decl x = 1 + 4
decl y = 2
decl num = x + y * (3 + 5)
print num
</code></pre><h1 id=qa-僅代表本人意見 class=article-heading>Q&A (僅代表本人意見)<a class="headline-hash smoothScroll hover-show scrollspy" style=font-size:.75em;color:#000;padding-left:.25em href=#qa-僅代表本人意見><span class=iconify data-icon=octicon-link data-inline=false></span></a></h1><details><summary><span>建議心理素質強健者再行觀看</span></summary><ul><li><strong>Q</strong> 為何編譯系統<del>目前</del>為必修?</li><li><strong>A</strong> 這需要回顧一下整個資訊工程的範疇，一般這個科系會有一些硬體課程以及多數的軟體課程 (包含數學、理論)，編譯系統是連接兩大領域的科學，因此在這堂課會用到幾乎所有在大學的所學 (例如，程式設計、資料結構、演算法、作業系統、計算理論)，雖然沒有到使用硬體指令 (否則會太難，想學可以參考 Jserv 的課)，不過可以說是整個大學的總整理。</li><li><strong>Q</strong> 為何編譯系統這麼難?</li><li><strong>A</strong> 其實課程部分一點也不難，每年超過100分的大概都有 20 個已經超過修課人數的一成，要不及格只可能是上課都沒在聽、考試沒複習、作業有問題都沒有問幾乎每次都沒交。如果是編譯器領域的話的確是難，但相對的會的人就少。</li><li><strong>Q</strong> 為何作業沒有部份給分?</li><li><strong>A</strong> 試想你之後出社會，老闆要你開發產品而你只能寫出屍體，連執行都不行，這樣你覺得老闆要給你多少薪水。你總不能跟他說我寫了哪些功能只是不能跑，所以應該要部份給薪吧。</li></ul></details>Last modified: Jul 26, 2021<div class=row><script type=text/javascript>document.write("<iframe scrolling='no' frameborder='0' class='center' sandbox='allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox allow-storage-access-by-user-activation' style='' src='https://button.like.co/in/embed/aben20807/button?referrer="+encodeURIComponent(location.href.split("?")[0].split("#")[0])+"'></iframe>");</script></div><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"forrecording"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></div><div id=toc class="column col-2 hide-print"><div class="toc toc-nav toc-pills ml-0 col-3"><li class="nav-item pb-3 text-center"><span class="font-weight-bold mb-2">- CATALOG -</span></li><div id=toc-scroll class="noselect hide-scrollbar"><ul class=toc><li class=toc-item><a class="toc-link smoothScroll" href=#%e5%89%8d%e8%a8%80>前言</a></li></ul><ul class=toc><li class=toc-item><a class="toc-link smoothScroll" href=#%e6%9c%ac%e7%af%87%e6%89%80%e5%bb%ba%e6%a7%8b%e7%9a%84%e7%b7%a8%e8%ad%af%e5%99%a8>本篇所建構的編譯器</a></li></ul><ul class=toc><li class=toc-item><a class="toc-link smoothScroll" href=#%e7%92%b0%e5%a2%83%e8%a8%ad%e5%ae%9a>環境設定</a></li></ul><ul class=toc><ul class=toc><li class=toc-item><a class="toc-link smoothScroll" href=#%e4%bd%9c%e6%a5%ad%e7%b3%bb%e7%b5%b1>作業系統</a></li></ul></ul><ul class=toc><ul class=toc><li class=toc-item><a class="toc-link smoothScroll" href=#%e8%bb%9f%e9%ab%94%e5%ae%89%e8%a3%9d>軟體安裝</a></li></ul></ul><ul class=toc><li class=toc-item><a class="toc-link smoothScroll" href=#%e5%ae%9a%e7%be%a9%e6%9c%ac%e6%ac%a1%e6%95%99%e5%ad%b8%e7%9a%84%e8%aa%9e%e8%a8%80>定義本次教學的語言</a></li></ul><ul class=toc><ul class=toc><li class=toc-item><a class="toc-link smoothScroll" href=#%e5%9e%8b%e5%88%a5-type>型別 type</a></li></ul></ul><ul class=toc><ul class=toc><li class=toc-item><a class="toc-link smoothScroll" href=#%e9%81%8b%e7%ae%97%e5%ad%90-operator>運算子 operator</a></li></ul></ul><ul class=toc><ul class=toc><li class=toc-item><a class="toc-link smoothScroll" href=#%e5%85%b6%e4%bb%96%e7%ac%a6%e8%99%9f>其他符號</a></li></ul></ul><ul class=toc><ul class=toc><li class=toc-item><a class="toc-link smoothScroll" href=#%e9%97%9c%e9%8d%b5%e5%ad%97-keyword>關鍵字 keyword</a></li></ul></ul><ul class=toc><ul class=toc><li class=toc-item><a class="toc-link smoothScroll" href=#%e7%b0%a1%e5%8c%96%e7%9a%84%e6%96%87%e6%b3%95-grammar>簡化的文法 grammar</a></li></ul></ul><ul class=toc><ul class=toc><li class=toc-item><a class="toc-link smoothScroll" href=#%e7%af%84%e4%be%8b%e8%bc%b8%e5%85%a5>範例輸入</a></li></ul></ul><ul class=toc><li class=toc-item><a class="toc-link smoothScroll" href=#qa-%e5%83%85%e4%bb%a3%e8%a1%a8%e6%9c%ac%e4%ba%ba%e6%84%8f%e8%a6%8b>Q&A (僅代表本人意見)</a></li></ul></div><ul class=toc><li class=toc-item><a class="goto pl1 toc-item" id=gotop>⊛ Back to top</a></li><li class=toc-item><a class="goto pl1 toc-item" id=gobottom>⊛ Go to bottom</a></li><script type=text/javascript>fetchInject(["https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"]).then(()=>{var url="https://cdnjs.cloudflare.com/ajax/libs/jquery-smooth-scroll/2.2.0/jquery.smooth-scroll.min.js";$.getScript(url,function(){$("#gotop").click(function(event){$('html,body').animate({scrollTop:0},300,'swing',function(){$('a.toc-link').removeClass('active');});});$("#gobottom").click(function(event){$('html,body').animate({scrollTop:$(document).height()},300,'swing',function(){$('a.toc-link').removeClass('active');});});});});</script></ul></div></div></div></main><footer class="hide-print sans-serif f6 fw1 bg-black near-white bottom-0 w-100 pa3 db overflow-auto" role=contentinfo><p class="w-50 fr tr" style=font-size:.875rem!important>Made with Hugo and
<a class="no-underline no-underline-on-hover" href=https://github.com/aben20807/hugOuO target=_blank rel="noreferrer noopener">hugOuO</a></p><p class="w-50 near-white" style=font-size:.875rem!important>&copy; 2019-2021 Huang Po-Hsuan</p></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js></script><script type=text/javascript src=https://aben20807.github.io/js/hugouo.js async></script><script src=https://aben20807.github.io/js/story.js async></script><script>fetchInject(["https://cdn.jsdelivr.net/npm/baffle@0.3.6/dist/baffle.min.js"]).then(()=>{baffle(document.querySelector('h1')).start().set({speed:70,}).reveal(800,800);});</script><script type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type=text/x-mathjax-config>
    MathJax.Hub.Config({
      tex2jax: {
      inlineMath: [['$','$']],
      displayMath: [['$$','$$']],
      processEscapes: true,
      processEnvironments: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
      TeX: { equationNumbers: { autoNumber: "AMS" },
          extensions: ["AMSmath.js", "AMSsymbols.js"] }
      }
    });
  </script><script src=https://unpkg.com/zooming/build/zooming.min.js></script><script>document.addEventListener('DOMContentLoaded',function(){new Zooming({bgColor:'rgb(0, 0, 0)',bgOpacity:'0.8',customSize:'200%',enableGrab:false}).listen('.img-zoomable')})</script></body></html>